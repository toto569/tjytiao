<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>拼图游戏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            color: white;
        }

        .game-container {
            max-width: 400px;
            width: 100%;
            text-align: center;
        }

        h1 {
            margin: 20px 0;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .image-selector {
            margin: 20px 0;
        }

        .image-selector button {
            margin: 5px;
            padding: 10px 15px;
            font-size: 16px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .image-selector button:hover,
        .image-selector button.active {
            background: rgba(255,255,255,0.4);
            border-color: rgba(255,255,255,0.6);
        }

        .puzzle-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 15px;
            margin: 20px 0;
            max-width: 350px;
            margin-left: auto;
            margin-right: auto;
        }

        .puzzle-piece {
            aspect-ratio: 1;
            background-size: 300% 300%;
            background-repeat: no-repeat;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .puzzle-piece.selected {
            border-color: #ffff00;
            box-shadow: 0 0 15px rgba(255,255,0,0.6);
        }

        .puzzle-piece.empty {
            background: rgba(255,255,255,0.1);
            border: 2px dashed rgba(255,255,255,0.3);
        }

        .extra-piece {
            width: 33.333%;
            aspect-ratio: 1;
            background-size: 300% 300%;
            background-repeat: no-repeat;
            margin: 2px auto 10px auto;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .extra-piece.selected {
            border-color: #ffff00;
            box-shadow: 0 0 15px rgba(255,255,0,0.6);
        }

        .controls {
            margin: 20px 0;
        }

        .direction-pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            max-width: 150px;
            margin: 0 auto;
        }

        .direction-btn {
            padding: 15px;
            font-size: 18px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
        }

        .direction-btn:hover {
            background: rgba(255,255,255,0.4);
        }

        .direction-btn:active {
            transform: scale(0.95);
        }

        .shuffle-btn {
            margin: 20px 0;
            padding: 12px 25px;
            font-size: 16px;
            background: rgba(46, 204, 113, 0.8);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .shuffle-btn:hover {
            background: rgba(46, 204, 113, 1);
            transform: translateY(-2px);
        }

        .victory-message {
            display: none;
            background: rgba(46, 204, 113, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 18px;
            font-weight: bold;
            animation: celebrate 1s ease-in-out;
        }

        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .instructions {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 14px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>🧩 拼图游戏</h1>
        
        <div class="image-selector">
            <button onclick="selectImage('1.webp')" class="active" id="img1">图片1</button>
            <button onclick="selectImage('2.webp')" id="img2">图片2</button>
            <button onclick="selectImage('3.webp')" id="img3">图片3</button>
        </div>

        <div class="puzzle-board" id="puzzleBoard">
            <!-- 拼图片段将通过JavaScript生成 -->
        </div>

        <div class="extra-piece" id="extraPiece"></div>

        <div class="controls">
            <div class="direction-pad">
                <div></div>
                <button class="direction-btn" onclick="movePiece('up')">↑</button>
                <div></div>
                <button class="direction-btn" onclick="movePiece('left')">←</button>
                <div></div>
                <button class="direction-btn" onclick="movePiece('right')">→</button>
                <div></div>
                <button class="direction-btn" onclick="movePiece('down')">↓</button>
                <div></div>
            </div>
        </div>

        <button class="shuffle-btn" onclick="shufflePuzzle()">🔀 打乱拼图</button>

        <div class="victory-message" id="victoryMessage">
            🎉 恭喜你完成挑战！ 🎉
        </div>

        <div class="instructions">
            <strong>游戏说明：</strong><br>
            1. 选择一个图片开始游戏<br>
            2. 点击拼图片段选择，然后用方向键移动<br>
            3. 下方有一个额外的移动方格<br>
            4. 将所有片段拼回正确位置即可获胜
        </div>
    </div>

    <script>
        let currentImage = '1.webp';
        let selectedPiece = null;
        let puzzleState = [];
        let extraPiece = 8; // 额外片段的编号

        // 初始化拼图状态 (0-7是拼图板上的片段，8是额外片段)
        function initializePuzzle() {
            puzzleState = [0, 1, 2, 3, 4, 5, 6, 7, -1]; // -1表示空位
            extraPiece = 8;
            createPuzzlePieces();
            updateDisplay();
        }

        // 创建拼图片段
        function createPuzzlePieces() {
            const board = document.getElementById('puzzleBoard');
            board.innerHTML = '';
            
            for (let i = 0; i < 9; i++) {
                const piece = document.createElement('div');
                piece.className = 'puzzle-piece';
                piece.onclick = () => selectPiece('board', i);
                board.appendChild(piece);
            }
        }

        // 选择图片
        function selectImage(imageName) {
            currentImage = `am/${imageName}`;
            
            // 更新按钮状态
            document.querySelectorAll('.image-selector button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (imageName === '1.webp') document.getElementById('img1').classList.add('active');
            if (imageName === '2.webp') document.getElementById('img2').classList.add('active');
            if (imageName === '3.webp') document.getElementById('img3').classList.add('active');
            
            updateDisplay();
            document.getElementById('victoryMessage').style.display = 'none';
        }

        // 选择拼图片段
        function selectPiece(location, index) {
            // 清除之前的选择
            document.querySelectorAll('.puzzle-piece, .extra-piece').forEach(piece => {
                piece.classList.remove('selected');
            });

            if (location === 'board') {
                if (puzzleState[index] !== -1) {
                    selectedPiece = {location: 'board', index: index};
                    document.querySelectorAll('.puzzle-piece')[index].classList.add('selected');
                }
            } else if (location === 'extra') {
                selectedPiece = {location: 'extra', index: 0};
                document.getElementById('extraPiece').classList.add('selected');
            }
        }

        // 移动拼图片段
        function movePiece(direction) {
            if (!selectedPiece) return;

            if (selectedPiece.location === 'board') {
                moveBoardPiece(direction);
            } else if (selectedPiece.location === 'extra') {
                moveExtraPiece(direction);
            }
        }

        // 移动拼图板上的片段
        function moveBoardPiece(direction) {
            const index = selectedPiece.index;
            const row = Math.floor(index / 3);
            const col = index % 3;
            let targetIndex = -1;

            switch (direction) {
                case 'up':
                    if (row > 0) targetIndex = (row - 1) * 3 + col;
                    break;
                case 'down':
                    if (row < 2) {
                        targetIndex = (row + 1) * 3 + col;
                    } else if (index === 7 && extraPiece === -1) {
                        // 位置7的片段可以下移到额外位置
                        extraPiece = puzzleState[index];
                        puzzleState[index] = -1;
                        selectedPiece = null;
                        updateDisplay();
                        checkVictory();
                        return;
                    }
                    break;
                case 'left':
                    if (col > 0) targetIndex = row * 3 + (col - 1);
                    break;
                case 'right':
                    if (col < 2) targetIndex = row * 3 + (col + 1);
                    break;
            }

            if (targetIndex !== -1 && puzzleState[targetIndex] === -1) {
                // 移动到空位
                puzzleState[targetIndex] = puzzleState[index];
                puzzleState[index] = -1;
                selectedPiece.index = targetIndex;
                updateDisplay();
                checkVictory();
            }
        }

        // 移动额外片段
        function moveExtraPiece(direction) {
            if (direction === 'up') {
                // 额外片段向上移动到位置7（中间下方）
                if (puzzleState[7] === -1) {
                    puzzleState[7] = extraPiece;
                    extraPiece = -1;
                    selectedPiece = null;
                    updateDisplay();
                    checkVictory();
                }
            } else if (direction === 'down') {
                // 如果额外位置是空的，拼图板位置7的片段可以下移到额外位置
                if (extraPiece === -1 && puzzleState[7] !== -1) {
                    extraPiece = puzzleState[7];
                    puzzleState[7] = -1;
                    selectedPiece = null;
                    updateDisplay();
                    checkVictory();
                }
            }
        }

        // 更新显示
        function updateDisplay() {
            const pieces = document.querySelectorAll('.puzzle-piece');
            const extraPieceEl = document.getElementById('extraPiece');

            // 更新拼图板
            pieces.forEach((piece, index) => {
                if (puzzleState[index] === -1) {
                    piece.className = 'puzzle-piece empty';
                    piece.style.backgroundImage = '';
                } else {
                    piece.className = 'puzzle-piece';
                    const pieceNum = puzzleState[index];
                    const row = Math.floor(pieceNum / 3);
                    const col = pieceNum % 3;
                    piece.style.backgroundImage = `url('${currentImage}')`;
                    piece.style.backgroundPosition = `${-col * 100}% ${-row * 100}%`;
                }
            });

            // 更新额外片段
            if (extraPiece === -1) {
                extraPieceEl.style.backgroundImage = '';
                extraPieceEl.style.border = '2px dashed rgba(255,255,255,0.3)';
            } else {
                const row = Math.floor(extraPiece / 3);
                const col = extraPiece % 3;
                extraPieceEl.style.backgroundImage = `url('${currentImage}')`;
                extraPieceEl.style.backgroundPosition = `${-col * 100}% ${-row * 100}%`;
                extraPieceEl.style.border = '2px solid rgba(255,255,255,0.3)';
            }

            // 重新选择当前片段
            if (selectedPiece) {
                if (selectedPiece.location === 'board') {
                    if (puzzleState[selectedPiece.index] !== -1) {
                        pieces[selectedPiece.index].classList.add('selected');
                    } else {
                        selectedPiece = null;
                    }
                } else if (selectedPiece.location === 'extra' && extraPiece !== -1) {
                    extraPieceEl.classList.add('selected');
                }
            }
        }

        // 检查胜利条件
        function checkVictory() {
            const correctState = [0, 1, 2, 3, 4, 5, 6, 7, 8];
            const currentState = [...puzzleState];
            if (extraPiece !== -1) {
                currentState.push(extraPiece);
            }
            
            if (currentState.length === 9 && currentState.every((val, index) => val === correctState[index])) {
                document.getElementById('victoryMessage').style.display = 'block';
                selectedPiece = null;
                document.querySelectorAll('.puzzle-piece, .extra-piece').forEach(piece => {
                    piece.classList.remove('selected');
                });
            }
        }

        // 打乱拼图
        function shufflePuzzle() {
            do {
                puzzleState = [0, 1, 2, 3, 4, 5, 6, 7].sort(() => Math.random() - 0.5);
                puzzleState.push(-1); // 确保有一个空位
                extraPiece = 8;
            } while (isInCorrectOrder());
            
            selectedPiece = null;
            updateDisplay();
            document.getElementById('victoryMessage').style.display = 'none';
        }

        // 检查是否已经是正确顺序
        function isInCorrectOrder() {
            return puzzleState.slice(0, 8).every((val, index) => val === index) && extraPiece === 8;
        }

        // 添加额外片段点击事件
        document.getElementById('extraPiece').onclick = () => {
            if (extraPiece !== -1) {
                selectPiece('extra', 0);
            }
        };

        // 键盘支持
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowUp') movePiece('up');
            if (e.key === 'ArrowDown') movePiece('down');
            if (e.key === 'ArrowLeft') movePiece('left');
            if (e.key === 'ArrowRight') movePiece('right');
        });

        // 初始化游戏
        currentImage = 'am/1.webp'; // 设置默认图片路径
        initializePuzzle();
        shufflePuzzle();
    </script>
</body>
</html>