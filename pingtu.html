<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹¼å›¾æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            color: white;
        }

        .game-container {
            max-width: 400px;
            width: 100%;
            text-align: center;
        }

        h1 {
            margin: 20px 0;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .image-selector {
            margin: 20px 0;
        }

        .image-selector button {
            margin: 5px;
            padding: 10px 15px;
            font-size: 16px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .image-selector button:hover,
        .image-selector button.active {
            background: rgba(255,255,255,0.4);
            border-color: rgba(255,255,255,0.6);
        }

        .puzzle-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 15px;
            margin: 20px 0;
            max-width: 350px;
            margin-left: auto;
            margin-right: auto;
        }

        .puzzle-piece {
            aspect-ratio: 1;
            background-size: 300% 300%;
            background-repeat: no-repeat;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .puzzle-piece.selected {
            border-color: #ffff00;
            box-shadow: 0 0 15px rgba(255,255,0,0.6);
        }

        .puzzle-piece.empty {
            background: rgba(255,255,255,0.1);
            border: 2px dashed rgba(255,255,255,0.3);
        }

        .extra-piece {
            width: 33.333%;
            aspect-ratio: 1;
            background-size: 300% 300%;
            background-repeat: no-repeat;
            margin: 2px auto 10px auto;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .extra-piece.selected {
            border-color: #ffff00;
            box-shadow: 0 0 15px rgba(255,255,0,0.6);
        }

        .controls {
            margin: 20px 0;
        }

        .direction-pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            max-width: 150px;
            margin: 0 auto;
        }

        .direction-btn {
            padding: 15px;
            font-size: 18px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
        }

        .direction-btn:hover {
            background: rgba(255,255,255,0.4);
        }

        .direction-btn:active {
            transform: scale(0.95);
        }

        .shuffle-btn {
            margin: 20px 0;
            padding: 12px 25px;
            font-size: 16px;
            background: rgba(46, 204, 113, 0.8);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .shuffle-btn:hover {
            background: rgba(46, 204, 113, 1);
            transform: translateY(-2px);
        }

        .victory-message {
            display: none;
            background: rgba(46, 204, 113, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 18px;
            font-weight: bold;
            animation: celebrate 1s ease-in-out;
        }

        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .instructions {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 14px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ğŸ§© æ‹¼å›¾æ¸¸æˆ</h1>
        
        <div class="image-selector">
            <button onclick="selectImage('1.webp')" class="active" id="img1">å›¾ç‰‡1</button>
            <button onclick="selectImage('2.webp')" id="img2">å›¾ç‰‡2</button>
            <button onclick="selectImage('3.webp')" id="img3">å›¾ç‰‡3</button>
        </div>

        <div class="puzzle-board" id="puzzleBoard">
            <!-- æ‹¼å›¾ç‰‡æ®µå°†é€šè¿‡JavaScriptç”Ÿæˆ -->
        </div>

        <div class="extra-piece" id="extraPiece"></div>

        <div class="controls">
            <div class="direction-pad">
                <div></div>
                <button class="direction-btn" onclick="movePiece('up')">â†‘</button>
                <div></div>
                <button class="direction-btn" onclick="movePiece('left')">â†</button>
                <div></div>
                <button class="direction-btn" onclick="movePiece('right')">â†’</button>
                <div></div>
                <button class="direction-btn" onclick="movePiece('down')">â†“</button>
                <div></div>
            </div>
        </div>

        <button class="shuffle-btn" onclick="shufflePuzzle()">ğŸ”€ æ‰“ä¹±æ‹¼å›¾</button>

        <div class="victory-message" id="victoryMessage">
            ğŸ‰ æ­å–œä½ å®ŒæˆæŒ‘æˆ˜ï¼ ğŸ‰
        </div>

        <div class="instructions">
            <strong>æ¸¸æˆè¯´æ˜ï¼š</strong><br>
            1. é€‰æ‹©ä¸€ä¸ªå›¾ç‰‡å¼€å§‹æ¸¸æˆ<br>
            2. ç‚¹å‡»æ‹¼å›¾ç‰‡æ®µé€‰æ‹©ï¼Œç„¶åç”¨æ–¹å‘é”®ç§»åŠ¨<br>
            3. ä¸‹æ–¹æœ‰ä¸€ä¸ªé¢å¤–çš„ç§»åŠ¨æ–¹æ ¼<br>
            4. å°†æ‰€æœ‰ç‰‡æ®µæ‹¼å›æ­£ç¡®ä½ç½®å³å¯è·èƒœ
        </div>
    </div>

    <script>
        let currentImage = '1.webp';
        let selectedPiece = null;
        let puzzleState = [];
        let extraPiece = 8; // é¢å¤–ç‰‡æ®µçš„ç¼–å·

        // åˆå§‹åŒ–æ‹¼å›¾çŠ¶æ€ (0-7æ˜¯æ‹¼å›¾æ¿ä¸Šçš„ç‰‡æ®µï¼Œ8æ˜¯é¢å¤–ç‰‡æ®µ)
        function initializePuzzle() {
            puzzleState = [0, 1, 2, 3, 4, 5, 6, 7, -1]; // -1è¡¨ç¤ºç©ºä½
            extraPiece = 8;
            createPuzzlePieces();
            updateDisplay();
        }

        // åˆ›å»ºæ‹¼å›¾ç‰‡æ®µ
        function createPuzzlePieces() {
            const board = document.getElementById('puzzleBoard');
            board.innerHTML = '';
            
            for (let i = 0; i < 9; i++) {
                const piece = document.createElement('div');
                piece.className = 'puzzle-piece';
                piece.onclick = () => selectPiece('board', i);
                board.appendChild(piece);
            }
        }

        // é€‰æ‹©å›¾ç‰‡
        function selectImage(imageName) {
            currentImage = `am/${imageName}`;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.image-selector button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (imageName === '1.webp') document.getElementById('img1').classList.add('active');
            if (imageName === '2.webp') document.getElementById('img2').classList.add('active');
            if (imageName === '3.webp') document.getElementById('img3').classList.add('active');
            
            updateDisplay();
            document.getElementById('victoryMessage').style.display = 'none';
        }

        // é€‰æ‹©æ‹¼å›¾ç‰‡æ®µ
        function selectPiece(location, index) {
            // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
            document.querySelectorAll('.puzzle-piece, .extra-piece').forEach(piece => {
                piece.classList.remove('selected');
            });

            if (location === 'board') {
                if (puzzleState[index] !== -1) {
                    selectedPiece = {location: 'board', index: index};
                    document.querySelectorAll('.puzzle-piece')[index].classList.add('selected');
                }
            } else if (location === 'extra') {
                selectedPiece = {location: 'extra', index: 0};
                document.getElementById('extraPiece').classList.add('selected');
            }
        }

        // ç§»åŠ¨æ‹¼å›¾ç‰‡æ®µ
        function movePiece(direction) {
            if (!selectedPiece) return;

            if (selectedPiece.location === 'board') {
                moveBoardPiece(direction);
            } else if (selectedPiece.location === 'extra') {
                moveExtraPiece(direction);
            }
        }

        // ç§»åŠ¨æ‹¼å›¾æ¿ä¸Šçš„ç‰‡æ®µ
        function moveBoardPiece(direction) {
            const index = selectedPiece.index;
            const row = Math.floor(index / 3);
            const col = index % 3;
            let targetIndex = -1;

            switch (direction) {
                case 'up':
                    if (row > 0) targetIndex = (row - 1) * 3 + col;
                    break;
                case 'down':
                    if (row < 2) {
                        targetIndex = (row + 1) * 3 + col;
                    } else if (index === 7 && extraPiece === -1) {
                        // ä½ç½®7çš„ç‰‡æ®µå¯ä»¥ä¸‹ç§»åˆ°é¢å¤–ä½ç½®
                        extraPiece = puzzleState[index];
                        puzzleState[index] = -1;
                        selectedPiece = null;
                        updateDisplay();
                        checkVictory();
                        return;
                    }
                    break;
                case 'left':
                    if (col > 0) targetIndex = row * 3 + (col - 1);
                    break;
                case 'right':
                    if (col < 2) targetIndex = row * 3 + (col + 1);
                    break;
            }

            if (targetIndex !== -1 && puzzleState[targetIndex] === -1) {
                // ç§»åŠ¨åˆ°ç©ºä½
                puzzleState[targetIndex] = puzzleState[index];
                puzzleState[index] = -1;
                selectedPiece.index = targetIndex;
                updateDisplay();
                checkVictory();
            }
        }

        // ç§»åŠ¨é¢å¤–ç‰‡æ®µ
        function moveExtraPiece(direction) {
            if (direction === 'up') {
                // é¢å¤–ç‰‡æ®µå‘ä¸Šç§»åŠ¨åˆ°ä½ç½®7ï¼ˆä¸­é—´ä¸‹æ–¹ï¼‰
                if (puzzleState[7] === -1) {
                    puzzleState[7] = extraPiece;
                    extraPiece = -1;
                    selectedPiece = null;
                    updateDisplay();
                    checkVictory();
                }
            } else if (direction === 'down') {
                // å¦‚æœé¢å¤–ä½ç½®æ˜¯ç©ºçš„ï¼Œæ‹¼å›¾æ¿ä½ç½®7çš„ç‰‡æ®µå¯ä»¥ä¸‹ç§»åˆ°é¢å¤–ä½ç½®
                if (extraPiece === -1 && puzzleState[7] !== -1) {
                    extraPiece = puzzleState[7];
                    puzzleState[7] = -1;
                    selectedPiece = null;
                    updateDisplay();
                    checkVictory();
                }
            }
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            const pieces = document.querySelectorAll('.puzzle-piece');
            const extraPieceEl = document.getElementById('extraPiece');

            // æ›´æ–°æ‹¼å›¾æ¿
            pieces.forEach((piece, index) => {
                if (puzzleState[index] === -1) {
                    piece.className = 'puzzle-piece empty';
                    piece.style.backgroundImage = '';
                } else {
                    piece.className = 'puzzle-piece';
                    const pieceNum = puzzleState[index];
                    const row = Math.floor(pieceNum / 3);
                    const col = pieceNum % 3;
                    piece.style.backgroundImage = `url('${currentImage}')`;
                    piece.style.backgroundPosition = `${-col * 100}% ${-row * 100}%`;
                }
            });

            // æ›´æ–°é¢å¤–ç‰‡æ®µ
            if (extraPiece === -1) {
                extraPieceEl.style.backgroundImage = '';
                extraPieceEl.style.border = '2px dashed rgba(255,255,255,0.3)';
            } else {
                const row = Math.floor(extraPiece / 3);
                const col = extraPiece % 3;
                extraPieceEl.style.backgroundImage = `url('${currentImage}')`;
                extraPieceEl.style.backgroundPosition = `${-col * 100}% ${-row * 100}%`;
                extraPieceEl.style.border = '2px solid rgba(255,255,255,0.3)';
            }

            // é‡æ–°é€‰æ‹©å½“å‰ç‰‡æ®µ
            if (selectedPiece) {
                if (selectedPiece.location === 'board') {
                    if (puzzleState[selectedPiece.index] !== -1) {
                        pieces[selectedPiece.index].classList.add('selected');
                    } else {
                        selectedPiece = null;
                    }
                } else if (selectedPiece.location === 'extra' && extraPiece !== -1) {
                    extraPieceEl.classList.add('selected');
                }
            }
        }

        // æ£€æŸ¥èƒœåˆ©æ¡ä»¶
        function checkVictory() {
            const correctState = [0, 1, 2, 3, 4, 5, 6, 7, 8];
            const currentState = [...puzzleState];
            if (extraPiece !== -1) {
                currentState.push(extraPiece);
            }
            
            if (currentState.length === 9 && currentState.every((val, index) => val === correctState[index])) {
                document.getElementById('victoryMessage').style.display = 'block';
                selectedPiece = null;
                document.querySelectorAll('.puzzle-piece, .extra-piece').forEach(piece => {
                    piece.classList.remove('selected');
                });
            }
        }

        // æ‰“ä¹±æ‹¼å›¾
        function shufflePuzzle() {
            do {
                puzzleState = [0, 1, 2, 3, 4, 5, 6, 7].sort(() => Math.random() - 0.5);
                puzzleState.push(-1); // ç¡®ä¿æœ‰ä¸€ä¸ªç©ºä½
                extraPiece = 8;
            } while (isInCorrectOrder());
            
            selectedPiece = null;
            updateDisplay();
            document.getElementById('victoryMessage').style.display = 'none';
        }

        // æ£€æŸ¥æ˜¯å¦å·²ç»æ˜¯æ­£ç¡®é¡ºåº
        function isInCorrectOrder() {
            return puzzleState.slice(0, 8).every((val, index) => val === index) && extraPiece === 8;
        }

        // æ·»åŠ é¢å¤–ç‰‡æ®µç‚¹å‡»äº‹ä»¶
        document.getElementById('extraPiece').onclick = () => {
            if (extraPiece !== -1) {
                selectPiece('extra', 0);
            }
        };

        // é”®ç›˜æ”¯æŒ
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowUp') movePiece('up');
            if (e.key === 'ArrowDown') movePiece('down');
            if (e.key === 'ArrowLeft') movePiece('left');
            if (e.key === 'ArrowRight') movePiece('right');
        });

        // åˆå§‹åŒ–æ¸¸æˆ
        currentImage = 'am/1.webp'; // è®¾ç½®é»˜è®¤å›¾ç‰‡è·¯å¾„
        initializePuzzle();
        shufflePuzzle();
    </script>
</body>
</html>